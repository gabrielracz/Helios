#include "global.h"

void setup() {
	Serial.begin(BAUD);
	Serial.setTimeout(5);
}


int read_all(char* buf, int buflen) {
	int br = 0;
	int tot = 0;
	while((br = Serial.readBytes(buf + tot, buflen - tot)) > 0){
		tot += br;
	}
	return tot;
}

Packet p = {0, 0};
char buf[64];

void loop() {
	if(Serial.available() >= sizeof(Packet)-2) { 
		memset(p.msg.buf, 0, sizeof(p.msg.buf));
		int br = read_all(p.msg.buf, sizeof(p.msg.buf));
		p.msg.len = br;
		Serial.write(p.data, sizeof(p.data));
	}    
}
